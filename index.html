<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>

    <div id="my-timeline">
      
    </div>

    <div id="user-timeline" style="display:none">
      <a id="back" href="#my-timeline">Back to my timeline</a>
    </div>

    <script>

      $(document).ready(function(){
        //var $body = $('body');
        //$body.html('');

        index = streams.home.length -1;

        var add = (function () {
          var counter = 0;
          return function () {return counter += 1;}
        })();

        var offset = 0;

        while(index > 0){
          //offset = (function(index){ return index; });
          var tweet = streams.home[index];
          var $tweet = $('<div class="tweet"></div>');

          $tweet.html('@<a class="user-link" href="#' + tweet.user + '">'+ tweet.user + '</a>: ' + tweet.message + ' | ' + tweet.created_at);
          $tweet.appendTo('#my-timeline');
          index -= 1;
          offset = add();
        }

        /*

        (function(){
          var workingOffset = function(){ 
            var saveOffset = offset;
            return (function(){ return saveOffset; })();
          };

          var newTweets = streams.home.slice(workingOffset());

          for(var i=0; i < newTweets.length; i++){
            var tweet = newTweets[i];
            var $tweet = $('<div></div>');

            $tweet.text('@' + tweet.user + ': ' + tweet.message + ' | ' + tweet.created_at);
            $tweet.prependTo($body).hide().fadeIn( 800 );
            offset = add();
          }

          setTimeout(arguments.callee, 500);
        })();

        */        


        // Check for new tweets
          // Wait some time
          // See if there are tweets newer than current
          // Display new tweets


        // Get a user
        // Retrieve user's tweets
        // Display user's tweets

        $('.user-link').on('click', function(){
          var user = $(this).text();
          $('#user-timeline').toggle();
          $('#my-timeline').toggle();
          generateUserTimeline(user);
        });

        $('#back').on('click', function(){
          $('#user-timeline').toggle();
          $('#user-timeline').find('.tweet').remove();
          $('#my-timeline').toggle();
        });

        function generateUserTimeline(user){
          var timeline = streams.users[user];
          displayTweets(timeline);
          
        }

        function generateMyTimeline (timeline){

        }

        function displayTweets (timeline){
          for(var i=0; i < timeline.length; i++){
            var tweet = timeline[i];
            var $tweet = $('<div class="tweet"></div>');

            $tweet.html('@<a class="user-link" href="#' + tweet.user + '">'+ tweet.user + '</a>: ' + tweet.message + ' | ' + tweet.created_at);
            $tweet.prependTo('#user-timeline').hide().fadeIn( 400 );
            //offset = add();
          }
        }

      });

    </script>
  </body>
</html>
